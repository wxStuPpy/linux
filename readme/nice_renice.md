
在 Unix/Linux 系统中，**`nice`** 和 **`renice`** 是用于调整进程优先级的命令。进程优先级决定了系统调度器分配 CPU 资源的倾向，优先级越高的进程（数值越小）越容易获得 CPU 时间。以下是两者的详细说明：


### **一、`nice` 命令：启动进程时设置优先级**
#### **作用**
- 在启动进程时，为其指定一个 **nice 值**（优先级），范围通常为 **`-20`（最高优先级）到 `19`**（最低优先级，默认值）。
- **普通用户**只能设置 **`nice 值 ≥ 0`**（降低优先级），**root 用户**可设置任意值（包括负数，提高优先级）。

#### **语法**
```bash
nice [选项] [命令及参数]
```

#### **常用选项**
- `-n <数值>`：指定 nice 值（`数值` 为 `-20` 到 `19` 之间的整数）。  
  示例：  
  ```bash
  # 普通用户以 nice 值 5 启动进程（降低优先级）
  nice -n 5 ./program

  # root 用户以 nice 值 -5 启动进程（提高优先级）
  sudo nice -n -5 ./high_priority_program
  ```

#### **注意**
- nice 值越大，进程优先级越低（更晚获得 CPU 资源）。
- 若未指定 `-n`，默认使用 nice 值 `10`（不同系统可能有差异）。


### **二、`renice` 命令：调整已运行进程的优先级**
#### **作用**
- 用于修改**正在运行的进程**的 nice 值，无需重启进程。
- 权限要求与 `nice` 相同：普通用户只能调整自己的进程且 nice 值 ≥ 0，root 用户可调整任意进程。

#### **语法**
```bash
renice [选项] <nice 值> <进程 PID 或用户名>
```

#### **常用选项**
- `-n <数值>`：指定新的 nice 值（可选，若省略则直接跟数值）。  
- `-p <PID>`：通过进程 PID 指定目标进程（常用）。  
- `-u <用户名>`：通过用户名批量调整该用户的所有进程。  

#### **示例**
1. **通过 PID 调整进程优先级**  
   ```bash
   # 普通用户将 PID 为 1234 的进程 nice 值设为 8（需拥有该进程权限）
   renice 8 -p 1234

   # root 用户将 PID 为 5678 的进程 nice 值设为 -3
   sudo renice -n -3 -p 5678
   ```

2. **通过用户名批量调整**  
   ```bash
   # 将用户 "testuser" 的所有进程 nice 值设为 10
   sudo renice 10 -u testuser
   ```

#### **注意**
- 若进程属于其他用户，普通用户会提示权限不足，需用 `sudo`。
- 调整后，新的优先级会立即生效，但系统调度可能需要时间体现变化。


### **三、nice 值与优先级的关系**
| nice 值范围   | 优先级（由高到低） | CPU 资源分配倾向       |
|---------------|--------------------|------------------------|
| `-20` 到 `-1` | 高优先级           | 优先获得 CPU 时间       |
| `0` 到 `19`   | 低优先级（默认 `0`）| 需等待高优先级进程运行 |

#### **关键说明**
- **nice 值不是进程的唯一优先级决定因素**：系统还会根据进程的实时优先级（`rt_priority`）、动态优先级（`dynamic priority`）等综合调度。
- **优先级调整的影响**：提高优先级可能导致其他进程响应变慢，需谨慎操作（尤其是设置负数 nice 值）。


### **四、查看进程当前优先级**
使用 `ps` 命令结合参数查看进程的 nice 值（`NI` 列）和实时优先级（`PR` 列）：  
```bash
ps -eo pid,user,ni,pr,cmd
```
- **`NI`（nice 值）**：即通过 `nice/renice` 设置的优先级。  
- **`PR`（进程优先级）**：系统计算的实际调度优先级，数值越小优先级越高（`PR = 20 + NI`，但可能受其他因素调整）。


### **五、应用场景**
1. **低优先级任务**：如后台备份、日志处理等，使用 `nice` 降低优先级，避免影响前台交互进程。  
   ```bash
   nice -n 10 backup_script.sh
   ```

2. **高优先级任务**：如实时数据处理（需 root 权限），使用 `renice` 提高优先级。  
   ```bash
   sudo renice -n -5 -p 9876
   ```

3. **资源抢占控制**：通过调整多个进程的优先级，合理分配 CPU 资源（如让数据库进程优先级高于普通应用）。


### **总结**
- **`nice`**：启动进程时预设优先级，适合“防患于未然”。  
- **`renice`**：动态调整运行中进程的优先级，适合“事后优化”。  
- **谨慎使用负数 nice 值**：可能导致系统资源分配失衡，仅在明确需求下由 root 操作。